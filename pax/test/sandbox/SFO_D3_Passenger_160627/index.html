<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ >
		<title>Smoothed D3.js Radar Chart</title>

		<!-- Google fonts -->
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

		<!-- D3.js -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
		<script type="text/javascript" src="profiles.js"></script>
		
		<style>
			body {
				font-family: 'Open Sans', sans-serif;
				font-size: 11px;
				font-weight: 300;
				fill: #242424;
				text-align: center;
				text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
				cursor: default;
				padding-top: 30px;
			}
			
			.legend {
				font-family: 'Raleway', sans-serif;
				fill: #333333;
			}
			
			.tooltip {
				fill: #333333;
			}
		</style>
	
	</head>
	<body>

		<div id="body">
			<div class="radarChart"></div>
		</div>

		<script src="radarChart.js"></script>	
		<script>
			////////////////////////////////////////////////////////////// 
			//////////////////////// Set-Up ////////////////////////////// 
			////////////////////////////////////////////////////////////// 

			var margin = {top: 100, right: 100, bottom: 100, left: 100},
				width = Math.min(700, window.innerWidth - 10) - margin.left - margin.right,
				height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);
					
			////////////////////////////////////////////////////////////// 
			////////////////////////// Data ////////////////////////////// 
			////////////////////////////////////////////////////////////// 

			var countAll = [],
				countT1 = [],
				countT2 = [],
				countT3 = [],
				countTi = [];


			var dataAll = [],
				dataT1 = [],
				dataT2 = [],
				dataT3 = [],
				dataTi = [];

			for (var i=0; i<allProfiles.length; i++) {

				var keys = Object.keys(allProfiles[i]),
					dat = [];

				for (var k=3; k<8; k++) {
					dat.push({axis:keys[k], value:allProfiles[i][keys[k]]/100})
				}
				dataAll.push(dat);
				countAll.push(allProfiles[i].count)
			}
			for (var i=0; i<t1Profiles.length; i++) {

				var keys = Object.keys(t1Profiles[i]),
					dat = [];

				for (var k=3; k<8; k++) {
					dat.push({axis:keys[k], value:t1Profiles[i][keys[k]]/100})
				}
				dataT1.push(dat);
				countT1.push(t1Profiles[i].count);
			}
			for (var i=0; i<t2Profiles.length; i++) {

				var keys = Object.keys(t2Profiles[i]),
					dat = [];

				for (var k=3; k<8; k++) {
					dat.push({axis:keys[k], value:t2Profiles[i][keys[k]]/100})
				}
				dataT2.push(dat);
				countT2.push(t2Profiles[i].count);
			}
			for (var i=0; i<t3Profiles.length; i++) {

				var keys = Object.keys(t3Profiles[i]),
					dat = [];

				for (var k=3; k<8; k++) {
					dat.push({axis:keys[k], value:t3Profiles[i][keys[k]]/100})
				}
				dataT3.push(dat);
				countT3.push(t3Profiles[i].count);
			}
			for (var i=0; i<tiProfiles.length; i++) {

				var keys = Object.keys(tiProfiles[i]),
					dat = [];

				for (var k=3; k<8; k++) {
					dat.push({axis:keys[k], value:tiProfiles[i][keys[k]]/100})
				}
				dataTi.push(dat);
				countTi.push(tiProfiles[i].count);
			}
			////////////////////////////////////////////////////////////// 
			//////////////////// Draw the Chart ////////////////////////// 
			////////////////////////////////////////////////////////////// 

			var color = d3.scale.ordinal()
				.range(["#ff8c00","#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c"]);
				
			var radarChartOptions = {
			  w: width,
			  h: height,
			  margin: margin,
			  maxValue: 1,
			  levels: 5,
			  roundStrokes: false,
			  color: color
			};

			var i = 11;
			//Call function to draw the Radar chart
			RadarChart(".radarChart", [dataT1[i], dataT2[i], dataT3[i], dataTi[i]], radarChartOptions);

			////////////////////////////////////////////
			/////////// Initiate legend ////////////////
			////////////////////////////////////////////

			//Legend titles
			var LegendOptions = ['t1 - ' + countT1[i] + ' passengers',
				't2 - ' + countT2[i] + ' passengers',
				't3 - ' + countT3[i] + ' passengers',
				'ti - ' + countTi[i] + ' passengers'];

			var svg = d3.select('#body')
				.selectAll('svg')
				.append('svg')
				.attr("width", radarChartOptions.w+300)
				.attr("height", radarChartOptions.h)

			//Create the title for the legend
			var text = svg.append("text")
				.attr("class", "title")
				.attr('transform', 'translate(90,0)') 
				.attr("x", radarChartOptions.w - 110)
				.attr("y", 10)
				.attr("font-size", "12px")
				//.attr("font-weight", "bold")
				.attr("fill", "#404040")
				.text(allProfiles[i].name);
					
			//Initiate Legend	
			var legend = svg.append("g")
				.attr("class", "legend")
				.attr("height", 100)
				.attr("width", 200)
				.attr('transform', 'translate(45,20)') 
				;
				//Create colour squares
				legend.selectAll('rect')
				  .data(LegendOptions)
				  .enter()
				  .append("rect")
				  .attr("x", radarChartOptions.w - 65)
				  .attr("y", function(d, i){ return i * 20;})
				  .attr("width", 10)
				  .attr("height", 10)
				  .style("fill", function(d, i){ return color(i);})
				  ;
				//Create text next to squares
				legend.selectAll('text')
				  .data(LegendOptions)
				  .enter()
				  .append("text")
				  .attr("x", radarChartOptions.w - 48)
				  .attr("y", function(d, i){ return i * 20 + 9;})
				  .attr("font-size", "11px")
				  .attr("fill", "#737373")
				  .text(function(d) { return d; })
				  ;	

		</script>
	</body>
</html>